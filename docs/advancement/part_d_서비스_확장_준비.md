# Part D. 서비스 확장 준비 (기술·운영)

> **문서**: Part D (단일 파트 작업용)  
> **상태**: 완료 | **최종 갱신**: 2026-02-07 (D-1, D-2 반영)  
> **선행 파트**: [part_b_고도화_방향_및_로드맵.md](part_b_고도화_방향_및_로드맵.md), [part_c_IPO_투자자_준비사항.md](part_c_IPO_투자자_준비사항.md) — Part C의 "무엇을 준비할지"에 대응하여, Part D는 "어떻게 확장할지(실행)"를 구체화한다.  
> **상위 통합본**: [../service_advancement_plan.md](../service_advancement_plan.md)

이 문서는 **Part D만** 다룰 때 사용한다. 트래픽·다국어·수익화·모니터링을 실행 관점에서 정리한다.

---

## D.1 트래픽·데이터 확장 (Part B 비기능 고도화·확장성 연계)

Part B B.2 "확장성 | 데이터: DB/스토리지 도입 시점(PostgreSQL 등), 읽기/쓰기 규모 예측"과 동일 방향으로 실행 항목을 구체화한다.

- **캐시 (실행)**: Cloudflare 엣지 — (1) 정적 에셋: 장기 캐시(1일~1주), 버전/해시 무효화. (2) API(운세·별자리): 쿼리 키(날짜·sign·locale) 기준, TTL 1시간, Stale-While-Revalidate. (3) Cache-Control·CDN 규칙 문서화.
- **DB 도입 시점**: 인증·구독 도입 시점에 영속 계층 필요. MAU 50만 전 PostgreSQL(또는 RDS) 도입. 읽기/쓰기 규모 예측 후 리드 레플리카·Redis 캐시 검토. 호스팅 지역은 타겟(한국·글로벌)에 맞춰 선택.
- **세션·파일 스토리지**: 세션 — DB 테이블 또는 Redis, TTL·갱신 정책 정의. 파일 — 프로필·업로드는 S3 호환(Cloudflare R2 등), 버킷 정책·URL 서빙·접근 제어(공개/비공개) 정의.

---

## D.2 다국어·현지화

- **현재**: 5개 언어(ko, en, zh, ja, es) 유지. next-intl·메시지 JSON, 운세·별자리·궁합 데이터/템플릿 다국어.
- **신규 언어 추가 절차**: (1) next-intl `messages/{locale}.json` 추가. (2) `public/data`·운세 템플릿·별자리/궁합 데이터에 locale 키 추가. (3) 번역 QA 체크리스트 수행. (4) config locale 목록·기본 locale 반영.
- **현지화 체크리스트**:
  - **통화**: 결제·구독 도입 시 표시 통화(USD/KRW 등)·결제 통화 정책, locale별 통화 포맷.
  - **날짜·숫자**: locale별 날짜/시간/숫자 형식 적용, next-intl 또는 Intl API 사용.
  - **라우팅(선택)**: locale 기반 라우팅(`/ko/`, `/en/` 등) 도입 시 — 라우트 구조 정의, 기본 locale 리다이렉트, hreflang·SEO 반영.

---

## D.3 수익화 연동

- **결제 파이프라인**: PG·빌링(구독) 벤더 선정 → 연동(결제·웹훅·이벤트) → 구독 상태·엔티티 연동 → 정기 결제 실패 시 재시도·알림·상태 전환 플로우. 카드 데이터 비저장(PCI 최소화) 유지.
- **환불 정책**: 환불 가능 기간·조건(미사용 기간 등) 명시, PG/빌링 측 환불 처리·웹훅 반영, 구독/액세스 상태 동기화.
- **광고 연동 시 고려사항**: (1) **브랜드 세이프티**: 노출 위치·광고주/콘텐츠 정책·블록리스트. (2) **개인정보**: COPPA(미성년자)·GDPR·동의·개인화 여부, 데이터 공유 범위.

---

## D.4 모니터링·운영 (Part C CTO 가용성·장애 대응 연계)

- **에러 추적**: 클라이언트·서버 에러 로그 수집 도구 도입, 에러율·유형별 집계, 알림 설정.
- **성능·비용 대시보드**: (1) 성능 — API 응답 시간(p50/p95)·에러율·가용성(Cloudflare Analytics·APM). (2) 비용 — Cloudflare·DB·외부 API(결제·AI) 사용량·비용, 예산 대비 알림.
- **배포·롤백**: 배포 절차(빌드→스테이징→프로덕션) 문서화. 롤백 — 이전 버전 재배포 절차·트래픽 전환 방식 정의.
- **장애 에스컬레이션**: 장애 감지 시 1차 담당·에스컬레이션 경로·연락처 정리. SLA — 목표 응답 시간·복구 목표(RTO) 문서화.

---

## Part D 핵심 산출 요약 (부록·통합본 반영용)

- **트래픽**: Cloudflare 정적/API 캐시 규칙·TTL, DB 도입 시점(MAU 50만 전), 세션(DB/Redis)·파일(S3 호환) 스토리지.
- **다국어**: 5개 언어 유지, 신규 언어 추가 4단계(메시지·콘텐츠·QA·config), 현지화(통화·날짜·선택 locale 라우팅).
- **수익화**: 결제(PG·빌링·환불·실패 처리)·광고(브랜드·개인정보·지표) 실행 항목.
- **운영**: 에러·성능·비용 모니터링, 배포·롤백·장애 담당·에스컬레이션.

---

*Part D 끝. 부록은 [part_부록.md](part_부록.md) 참조.*
