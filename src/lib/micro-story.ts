/**
 * 일일 마이크로 스토리 생성기
 * 별자리별 신화/전설 기반 짧은 이야기
 * Zeigarnik 효과: "내일 이야기가 궁금하다면..." 으로 재방문 유도
 */

import type { ZodiacSignId } from '@/types';
import { seededRandom, generateContentSeed, selectRandom, signKoreanNames } from './content-pipeline';

interface MicroStoryData {
  title: string;
  content: string;
  moral: string;
  teaser: string; // 내일 이야기 미리보기 (Zeigarnik 효과)
}

/** 별자리별 스토리 풀 */
const storyPools: Record<ZodiacSignId, MicroStoryData[]> = {
  aries: [
    {
      title: '황금 양털을 찾아서',
      content: '옛날 용감한 양이 있었습니다. 모두가 위험하다고 말린 산 너머의 황금 풀밭을, 양은 두려움 없이 향했습니다. 도중에 만난 폭풍도, 절벽도 양을 멈출 수 없었죠.',
      moral: '두려움을 넘어선 곳에 당신만의 황금이 기다립니다.',
      teaser: '내일은 양이 황금 풀밭에서 발견한 뜻밖의 것에 대해...',
    },
    {
      title: '첫 번째 불꽃',
      content: '세상에 불이 없던 시절, 양자리의 수호 정령이 태양에서 첫 번째 불꽃을 훔쳐왔습니다. 그 불꽃은 추위에 떨던 모든 별자리에게 따뜻함을 선물했죠.',
      moral: '당신의 열정은 세상을 따뜻하게 만드는 불꽃입니다.',
      teaser: '내일은 그 불꽃이 만들어낸 예상치 못한 기적에 대해...',
    },
    {
      title: '용기의 씨앗',
      content: '작은 양자리 별이 거대한 어둠 속으로 뛰어들었습니다. "혼자서는 무리야"라는 목소리를 뒤로하고, 별은 자신의 빛을 모아 하나의 등대를 만들었습니다.',
      moral: '한 사람의 용기가 모두를 위한 등대가 됩니다.',
      teaser: '내일은 그 등대가 다른 별들에게 일으킨 변화에 대해...',
    },
  ],
  taurus: [
    {
      title: '느린 걸음의 마법',
      content: '모든 별자리가 서둘러 달릴 때, 황소자리만 천천히 걸었습니다. 다른 이들은 비웃었지만, 황소는 길가의 숨겨진 보석들을 하나씩 주워 담았죠.',
      moral: '서두르지 않는 자만이 보는 보물이 있습니다.',
      teaser: '내일은 황소가 모은 보석으로 만든 놀라운 것에 대해...',
    },
    {
      title: '정원사의 비밀',
      content: '황소자리의 현자는 비밀 정원을 가꾸었습니다. 매일 같은 시간에, 같은 정성으로. 백 번째 날, 정원에서 세상에 없던 꽃이 피어났습니다.',
      moral: '꾸준함이 기적을 피워냅니다.',
      teaser: '내일은 그 꽃이 가진 놀라운 능력에 대해...',
    },
    {
      title: '흔들리지 않는 산',
      content: '폭풍이 몰아치는 밤, 모든 나무가 쓰러졌지만 산은 그 자리에 있었습니다. 아침이 되자 산의 품에서 새로운 생명들이 자라나기 시작했죠.',
      moral: '흔들리지 않는 당신이 다른 이들의 안식처가 됩니다.',
      teaser: '내일은 산이 품은 가장 특별한 생명에 대해...',
    },
  ],
  gemini: [
    {
      title: '두 개의 거울',
      content: '쌍둥이 별이 서로를 비추는 거울을 발견했습니다. 하나의 거울은 과거를, 다른 하나는 미래를 보여주었죠. 쌍둥이는 두 거울 사이에서 현재의 비밀을 발견했습니다.',
      moral: '다양한 관점 사이에서 진정한 답이 보입니다.',
      teaser: '내일은 거울이 보여준 미래의 비밀에 대해...',
    },
    {
      title: '바람의 메신저',
      content: '쌍둥이자리의 정령은 바람을 타고 메시지를 전했습니다. 어느 날, 한 마을의 절망적인 소식을 들은 정령은 바람에 희망의 노래를 실어 보냈죠.',
      moral: '당신의 말 한마디가 누군가의 운명을 바꿉니다.',
      teaser: '내일은 그 노래를 들은 마을에서 벌어진 일에 대해...',
    },
    {
      title: '천 개의 이야기',
      content: '쌍둥이자리의 이야기꾼은 밤마다 별들에게 이야기를 들려주었습니다. 천 번째 이야기를 마친 밤, 별들이 대답하기 시작했죠.',
      moral: '소통을 멈추지 않으면, 우주도 답합니다.',
      teaser: '내일은 별들이 전한 놀라운 메시지에 대해...',
    },
  ],
  cancer: [
    {
      title: '달의 요람',
      content: '게자리의 수호신은 달빛으로 요람을 만들었습니다. 상처받은 별들이 그 요람에서 쉬면 다시 빛을 되찾았죠. 수호신은 결코 지치지 않았습니다.',
      moral: '당신의 돌봄은 치유의 마법입니다.',
      teaser: '내일은 요람에서 가장 밝게 빛난 별의 이야기에 대해...',
    },
    {
      title: '기억의 조개',
      content: '바닷가에서 특별한 조개를 발견한 게자리. 조개를 귀에 대면 가장 행복했던 기억의 소리가 들렸습니다. 슬픈 날에는 그 소리가 위로가 되었죠.',
      moral: '아름다운 추억은 어떤 폭풍도 견디는 닻입니다.',
      teaser: '내일은 조개가 들려준 가장 특별한 기억에 대해...',
    },
    {
      title: '눈물의 강',
      content: '게자리의 눈물이 모여 강이 되었습니다. 사람들은 그 강물이 메마른 땅을 적시고, 꽃을 피우는 것을 보았죠. 슬픔마저도 생명을 키우는 것이었습니다.',
      moral: '당신의 감정은 세상을 풍요롭게 하는 물입니다.',
      teaser: '내일은 그 강가에서 만난 특별한 존재에 대해...',
    },
  ],
  leo: [
    {
      title: '잃어버린 왕관',
      content: '사자자리의 왕은 왕관을 잃었습니다. 왕관 없이도 당당히 서 있는 왕을 보고, 신하들은 깨달았죠. 진정한 왕관은 머리 위가 아니라 마음에 있다는 것을.',
      moral: '진정한 권위는 외부가 아닌 내면에서 옵니다.',
      teaser: '내일은 왕이 왕관 대신 발견한 더 귀한 것에 대해...',
    },
    {
      title: '태양의 심장',
      content: '옛날 태양이 잠시 쉬려 했을 때, 세상은 어둠에 빠졌습니다. 사자자리의 정령이 자신의 심장에 불을 밝혀 세상을 비추었죠.',
      moral: '당신 안의 빛은 어둠을 물리치는 태양입니다.',
      teaser: '내일은 태양이 돌아온 후 정령에게 건넨 선물에 대해...',
    },
    {
      title: '용감한 포효',
      content: '거대한 그림자가 숲을 덮었을 때, 모든 동물이 숨었습니다. 오직 사자만이 그림자를 향해 포효했고, 그 울림에 그림자는 사라졌습니다.',
      moral: '용기 있는 한 마디가 두려움을 물리칩니다.',
      teaser: '내일은 그림자가 진짜 무서워한 것의 정체에 대해...',
    },
  ],
  virgo: [
    {
      title: '별의 도서관',
      content: '처녀자리의 현자는 모든 별의 지식을 모아 우주 도서관을 만들었습니다. 작은 디테일 하나도 놓치지 않았죠. 그 도서관은 길을 잃은 모든 여행자의 등대가 되었습니다.',
      moral: '작은 것에 대한 정성이 큰 지혜를 만듭니다.',
      teaser: '내일은 도서관에서 발견된 비밀 책에 대해...',
    },
    {
      title: '치유의 약초',
      content: '처녀자리의 약사는 남들이 잡초라 부르는 풀에서 약초를 발견했습니다. 세심한 관찰로 발견한 그 약초는 가장 깊은 상처도 치유할 수 있었죠.',
      moral: '남들이 지나치는 곳에서 보물을 찾는 것이 당신의 능력입니다.',
      teaser: '내일은 약초로 치유된 가장 특별한 환자에 대해...',
    },
    {
      title: '완벽한 불완전',
      content: '처녀자리의 도공은 완벽한 그릇을 만들려 했지만 항상 작은 흠이 생겼습니다. 어느 날 그 흠 사이로 빛이 새어 나와, 세상에서 가장 아름다운 그릇이 되었습니다.',
      moral: '불완전함 속에 완벽함이 숨어 있습니다.',
      teaser: '내일은 그 빛이 비춘 곳에서 일어난 기적에 대해...',
    },
  ],
  libra: [
    {
      title: '공정한 저울',
      content: '천칭자리의 재판관은 진실과 거짓을 가리는 저울을 가지고 있었습니다. 어느 날 저울이 정확히 수평을 이루었을 때, 세상의 모든 갈등이 잠시 멈추었습니다.',
      moral: '균형이 이루어질 때, 평화가 찾아옵니다.',
      teaser: '내일은 저울이 기울어졌을 때 벌어진 일에 대해...',
    },
    {
      title: '하모니의 정원',
      content: '천칭자리의 음악가는 불협화음도 아름다운 화음으로 바꿀 수 있었습니다. 정원의 꽃들은 그 음악에 맞춰 색을 바꾸며 춤추었죠.',
      moral: '조화를 만드는 것은 세상에서 가장 아름다운 예술입니다.',
      teaser: '내일은 꽃들이 전한 비밀 메시지에 대해...',
    },
    {
      title: '두 날의 칼',
      content: '양쪽의 이야기를 모두 들은 천칭자리는 결정을 내리지 못했습니다. 하지만 그 망설임 속에서 제3의 길을 발견했고, 모두가 만족하는 답을 찾았습니다.',
      moral: '깊은 고민 끝에 최선의 답이 나옵니다.',
      teaser: '내일은 제3의 길에서 만난 예상 밖의 동행자에 대해...',
    },
  ],
  scorpio: [
    {
      title: '불사조의 재',
      content: '전갈자리의 불사조는 스스로 불 속에 뛰어들었습니다. 잿더미 속에서 다시 태어난 불사조는 이전보다 더 강하고 아름다웠습니다.',
      moral: '진정한 변화는 완전한 놓아줌에서 시작됩니다.',
      teaser: '내일은 잿더미 속에서 발견한 보석에 대해...',
    },
    {
      title: '심연의 빛',
      content: '가장 깊은 바다 밑에서, 전갈자리의 잠수부는 빛나는 진주를 발견했습니다. 아무도 가지 않는 깊이에서만 찾을 수 있는 보물이었죠.',
      moral: '가장 깊은 곳에 가장 귀한 것이 있습니다.',
      teaser: '내일은 그 진주가 가진 신비한 힘에 대해...',
    },
    {
      title: '비밀의 문',
      content: '전갈자리만 볼 수 있는 비밀의 문이 있었습니다. 문 너머에는 모든 존재의 진실이 적힌 책이 있었죠. 그 지식은 무겁지만, 강한 자만이 감당할 수 있었습니다.',
      moral: '진실을 감당하는 것이 진정한 강함입니다.',
      teaser: '내일은 책에 적힌 가장 충격적인 진실에 대해...',
    },
  ],
  sagittarius: [
    {
      title: '끝없는 지평선',
      content: '사수자리의 탐험가는 지평선 너머를 보겠다고 달렸습니다. 지평선은 계속 물러났지만, 달리는 동안 만난 풍경들이 인생 최고의 선물이 되었죠.',
      moral: '목적지보다 여정에서 진정한 보물을 발견합니다.',
      teaser: '내일은 탐험가가 지평선에서 마침내 본 것에 대해...',
    },
    {
      title: '진실의 화살',
      content: '사수자리의 궁수는 한 번도 과녁을 빗나간 적이 없었습니다. 비밀은 화살에 진심을 담았기 때문이죠. 진심으로 쏜 화살은 반드시 마음에 닿습니다.',
      moral: '진심은 언제나 목표에 도달합니다.',
      teaser: '내일은 화살이 도달한 예상치 못한 곳에 대해...',
    },
    {
      title: '별의 지도',
      content: '길을 잃은 사수자리는 하늘을 올려다보았습니다. 별들이 하나둘 연결되어 지도가 되었고, 그 지도는 아직 아무도 가지 않은 길을 가리키고 있었습니다.',
      moral: '길을 잃을 때 하늘을 보면 새로운 길이 보입니다.',
      teaser: '내일은 새로운 길에서 만난 신비로운 존재에 대해...',
    },
  ],
  capricorn: [
    {
      title: '산의 약속',
      content: '염소자리는 가장 높은 산에 오르겠다고 약속했습니다. 매일 한 걸음씩, 폭풍이 와도, 안개가 끼어도 멈추지 않았죠. 정상에서 본 풍경은 말로 표현할 수 없었습니다.',
      moral: '한 걸음씩 꾸준히 오르면 정상은 반드시 옵니다.',
      teaser: '내일은 정상에서 발견한 놀라운 비밀에 대해...',
    },
    {
      title: '시간의 건축가',
      content: '염소자리의 건축가는 천 년이 걸리는 탑을 짓기 시작했습니다. 사람들은 비웃었지만, 한 세대가 지나자 탑의 아름다움에 모두가 경탄했습니다.',
      moral: '시간을 투자하는 것이 가장 현명한 건축입니다.',
      teaser: '내일은 탑이 완성되었을 때 일어난 기적에 대해...',
    },
    {
      title: '겨울의 선물',
      content: '추운 겨울, 다른 별자리들은 봄을 기다렸지만, 염소자리는 겨울의 고요함 속에서 가장 깊은 깨달음을 얻었습니다.',
      moral: '어려운 시기야말로 가장 큰 성장의 기회입니다.',
      teaser: '내일은 겨울이 염소자리에게 건넨 비밀 선물에 대해...',
    },
  ],
  aquarius: [
    {
      title: '미래에서 온 편지',
      content: '물병자리는 미래에서 편지를 받았습니다. 편지에는 "지금 당신이 꿈꾸는 것이 모두 현실이 됩니다"라고 적혀 있었죠. 물병자리는 더 크게 꿈꾸기로 했습니다.',
      moral: '상상하는 것이 미래를 만드는 첫 걸음입니다.',
      teaser: '내일은 편지에 숨겨진 비밀 메시지에 대해...',
    },
    {
      title: '물병의 물',
      content: '물병자리의 물은 특별했습니다. 메마른 땅에 뿌리면 오래된 씨앗이 싹을 틔웠죠. 아무도 살지 않던 사막이 숲이 되었습니다.',
      moral: '당신의 아이디어가 불모지를 낙원으로 바꿉니다.',
      teaser: '내일은 그 숲에서 자란 가장 신기한 나무에 대해...',
    },
    {
      title: '규칙을 깨는 자',
      content: '모든 별이 정해진 궤도를 따를 때, 물병자리만 자신의 궤도를 만들었습니다. 처음엔 혼란스러웠지만, 그 새로운 길이 다른 별들에게도 자유를 주었습니다.',
      moral: '규칙을 깨는 것이 새로운 규칙을 만듭니다.',
      teaser: '내일은 새로운 궤도에서 만난 미지의 세계에 대해...',
    },
  ],
  pisces: [
    {
      title: '꿈의 바다',
      content: '물고기자리는 꿈과 현실의 경계에 사는 바다에서 헤엄쳤습니다. 그 바다에서는 상상하는 모든 것이 형태를 가졌죠. 가장 아름다운 꿈이 가장 아름다운 현실이 되었습니다.',
      moral: '꿈을 꾸는 것이 현실을 창조하는 것입니다.',
      teaser: '내일은 꿈의 바다에서 만난 신비로운 존재에 대해...',
    },
    {
      title: '눈물의 진주',
      content: '물고기자리의 눈물은 바다에 떨어지면 진주가 되었습니다. 세상의 아픔을 느낄 때마다 아름다운 보석이 만들어졌죠.',
      moral: '당신의 감수성은 세상에서 가장 귀한 보석을 만듭니다.',
      teaser: '내일은 가장 큰 진주가 가진 놀라운 비밀에 대해...',
    },
    {
      title: '두 마리 물고기',
      content: '서로 반대 방향으로 헤엄치는 두 마리 물고기는 결코 떨어지지 않았습니다. 하나는 과거를, 하나는 미래를 향했지만, 둘을 잇는 끈이 현재의 힘이었죠.',
      moral: '과거와 미래를 잇는 현재에 당신의 힘이 있습니다.',
      teaser: '내일은 끈이 끊어질 뻔한 위기의 순간에 대해...',
    },
  ],
};

/** 오늘의 마이크로 스토리 생성 */
export function generateDailyMicroStory(
  signId: ZodiacSignId,
  date: Date = new Date()
): MicroStoryData {
  const seed = generateContentSeed(signId, date, 'microstory');
  const random = seededRandom(seed);
  const stories = storyPools[signId];
  return selectRandom(stories, random);
}

/** 내일 스토리 티저 생성 (Zeigarnik 효과) */
export function getTomorrowTeaser(
  signId: ZodiacSignId,
  date: Date = new Date()
): string {
  const tomorrow = new Date(date);
  tomorrow.setDate(tomorrow.getDate() + 1);
  const story = generateDailyMicroStory(signId, tomorrow);
  return story.teaser;
}

/** 별자리별 스토리 수 */
export function getStoryCount(signId: ZodiacSignId): number {
  return storyPools[signId].length;
}
